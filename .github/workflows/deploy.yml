name: Build Laravel Vite and Deploy to Hostinger

on:
  push:
    branches:
      - main  # Jalankan saat push ke branch main

jobs:
  build-deploy:
    runs-on: ubuntu-latest

    steps:
      # 1. Ambil kode dari repo
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2. Setup PHP (untuk Laravel)
      - name: Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.2' # Sesuaikan versi PHP di server Hostinger
          extensions: mbstring, bcmath, intl
          coverage: none

      # 3. Setup Node.js (untuk Vite)
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      # 4. Install Dependencies Laravel
      - name: Install Composer Dependencies
        run: composer install --no-dev --optimize-autoloader

      # 5. Install Dependencies Frontend
      - name: Install NPM Dependencies
        run: npm install

      # 6. Build Frontend (Vite)
      - name: Build Vite Assets
        run: npm run build

      # 7. Deploy Folder build ke Hostinger
      - name: Deploy via SFTP
        uses: wlixcc/SFTP-Deploy-Action@v1.2.4
        with:
          server: ${{ secrets.HOSTINGER_HOST }}
          port: ${{ secrets.HOSTINGER_PORT }}
          username: ${{ secrets.HOSTINGER_USER }}
          ssh_private_key: ${{ secrets.HOSTINGER_KEY }}
          local_path: './public/build/*'
          remote_path: '~/public_html/build-it-2025/public/build/'
          args: '-r'
